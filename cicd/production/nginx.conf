# Hide the Nginx version from the 'Server' response header
server_tokens off;

server {
    listen 80 default_server;
    server_name _;
    root /var/www/feed/public;
    index index.php index.html;

    # Add security headers
    # X-Frame-Options: Prevents clickjacking attacks by controlling if the page can be placed in a frame.
    add_header X-Frame-Options "SAMEORIGIN" always;

    # X-Content-Type-Options: Prevents browsers from "sniffing" MIME types and helps prevent certain attacks.
    add_header X-Content-Type-Options "nosniff" always;

    # X-XSS-Protection: Activates the browser's built-in XSS filter.
    add_header X-XSS-Protection "1; mode=block" always;

    # Referrer-Policy: Controls how much referrer information is sent with requests.
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # Strict-Transport-Security: Enforces secure HTTPS connections for a specified duration.
    # This header should only be added to your HTTPS server block, after setting up your load balancer with SSL.
    # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # Serve static assets directly
    location ~ \.(css|js|gif|jpg|png|svg|ico|eot|ttf|woff|woff2)$ {
        try_files $uri =404;
        expires 1y;
        add_header Cache-Control "public, must-revalidate";
    }

    # Pass PHP requests to the PHP-FPM container
    location ~ \.php$ {
        fastcgi_pass localhost:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # Handle all other requests via Laravel's index.php
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
}
